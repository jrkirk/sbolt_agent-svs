#### propose explanation operator, when popping of the segment from the stack when the reason for popping is "completed action <new action>". because the agent is relying on instructor to determine when the action has successfully ended, it means that the operator application is unkown to the agent and should be learned

### for coding purposes proposing explain operator at topstate; fix it such that it fires only at appropriate places

### we are popping of the top of the stack now; note that the segment at the top of the current stack contains the operator that we are trying to learn. 

sp {topstate*propose*explain*operator
   (state <s> ^topstate <s>
   	      ^conversation.stack.segment <top>)
   (<top> ^purpose <p>
   	  ^next <next>)
   (<p> ^type explanation)
	 -->
   (<s> ^operator <op> + >)
   (<op> ^name explain
   	 ^segment <next>)
}


sp {elaborate*explain*query
   (state <s> ^name explain
   	      ^superstate.operator <op>)
   (<op> ^name explain
   	 ^segment <top>)
-->
   (<s> ^segment <top>)
} 

## in the explain operator, query episodic memory for the time when segment top was first seen on the top of the stack

sp {explain*retrieve*episode*episodic*memory
   (state <s> ^name explain
   	      ^segment <top>
	      ^epmem.command <epcom>)
   (<top> ^epmem-id  <eid>)
-->
   (<epcom> ^retrieve <eid>)
} 
sp {explain*copy*retrieved*episode
   (state <s> ^name explain
   	      ^epmem.result.retrieved <res>)
   (<res> ^missiles <m>
   	^blocked <b>
explain*copy*retrieved*episode	^x <x>
	^y <y>
	^direction <dr>)
-->
   (<s> ^missiles <m>
   	^blocked <b>
	^x <x>
	^y <y>
	^direction <dr>)
}

### in the now generated state; proposed the verb on the segment
sp {explain*propose*segment-verb
   (state <s> ^name explain
   	      ^segment <seg>)
   (<seg> ^purpose <p>)
   (<p> ^type environmental-action
   	^satisfaction <ps>) 
   # AM: Moved satisfaction info inside the event
   (<ps> ^action-event.type <info>)
   (<info> ^verb <verb-name>)
-->
   (<s> ^operator <op> + >)
   (<op> ^name <verb-name>)
}


### copy structures in the new instructed section
sp {explain*copy*superstate*relevant*structures
   (state <s> ^superstate <ss>)
   (<ss> ^name explain
   	 ^missiles <m>
   	^blocked <b>
	^x <x>
	^y <y>
	^direction <dr>)
-->
   (<s> ^missiles <m>
   	^blocked <b>
	^x <x>
	^y <y>
	^direction <dr>)
}


### --- elaborate problem-space
sp {explain*elaborate*problem-space
   (state <s> ^name <sname>
   	      ^superstate.name explain)
-->
   (<s> ^problem-space <p>)
   (<p> ^name <sname>
   	^default-state-copy yes
	^one-level-attributes blocked missiles x y direction)
}

### if an operator-tie occurs in instructed-action in the explain problem-space; name it selection
sp {selection*elaborate*name
   :default
   (state <s> ^superstate.supestate.name explain
   	      ^type tie)
   -->
   (<s> ^name selection)}


   